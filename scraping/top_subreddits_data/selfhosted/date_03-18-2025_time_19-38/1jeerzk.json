{
    "title": "Container Volume Backup: How to back-up docker container volumes that are inside a VM",
    "author": "4-PHASES",
    "subreddit": "selfhosted",
    "rank": 18,
    "score": 5,
    "upvote_ratio": 0.78,
    "num_comments (reported by reddit)": 8,
    "url": "https://www.reddit.com/r/selfhosted/comments/1jeerzk/container_volume_backup_how_to_backup_docker/",
    "id": "1jeerzk",
    "selftext": "Hey, hope all of you guys are well.\n\nI have a Truenas Scale latest, with it I have a VM dedicated to installing other container apps I am unable to install inside Truenas Scale it self. \n\nMy data storage is comprised of: \n\n* 1drive for Truenas Boot \n* 3 drives for Truenas Apps (RAID)\n* 1drive for backups (plan to make it RAID soon)\n* 1drive for VMs (Plan to make it RAID soon)\n\n\\*My setup is not optimal, feel free to give advice, as I plan to make it optimal in the near future, but my question above remains relevent.\n\nI do not want to backup the entire VM drive when I only need the container volumes that I have inside said VM. What is your recommendation of an app or service for me to use to backup docker volumes (that are inside my VM) to the Backup Drive (that is inside my Truenas)\n\nThe volumes I want to backup are related to apps like note-taking, project-management, personal-finance, vaultwarden, etc. (they are userfiles, databases, plugin files... etc)",
    "comments": [
        {
            "author": "mattsteg43",
            "body": "You either set up a backup to copy/sync/backup them out of the VM over the 'network', or you set the volumes up over NFS in the first place so you can handle them from the TrueNAS host natively.\n\n  \nOn a side note what on earth can you \"not install on TrueNAS\"?",
            "score": 2,
            "replies": [
                {
                    "author": "4-PHASES",
                    "body": "As I understand you, you suggest making a dataset (folder) from Truenas, and give the VM access to the dataset and create volumes inside that share dataset to mount them to the specific docker containers? Also,  that will be mount-bind right? \n\nYourQuestion: There are some apps that require me to enter the system and set them app from the CLI. Also, some require additional .env files, and thus I need to download the .env inside the system before running docker compose (truenas custom app installation only allows me to install from one docker compose file with no ability to add .env files)",
                    "score": 1,
                    "replies": [
                        {
                            "author": "mattsteg43",
                            "body": ">YourQuestion: There are some apps that require me to enter the system and set them app from the CLI. Also, some require additional .env files, and thus I need to download the .env inside the system before running docker compose (truenas custom app installation only allows me to install from one docker compose file with no ability to add .env files)\n\nYou can just e.g. install dockge (or portainer if you prefer) app in truenas and do this.  Or even just make your own directory structure and use docker compose on the CLI but dockge is 1000x more convenient.  There's not really any need for (or honestly utility in) custom apps imo.  Dockge and portainer are the only \"apps\" I have installed on TrueNAS.\n\n>As I understand you, you suggest making a dataset (folder) from Truenas, and give the VM access to the dataset and create volumes inside that share dataset to mount them to the specific docker containers? Also, that will be mount-bind right?\n\nOther than things like databases that can sometimes be squirrelly, I tend to set up NFS mounts in the compose file.  That way I can migrate containers around at will by stopping them one place and just starting them elsewhere.  Something like the below snippet.\n\n    volumes:\n      volume_name:\n        driver_opts:\n          type: nfs\n          o: addr=TRUENAS_IP,rw,soft,nolock,nfsvers=4\n          device: :/mnt/blah/docker_volumes/service_name/mount_name\n    services:\n      cool_service:\n        volumes:\n          - volume_name:/mount_point\n        ...",
                            "score": 1,
                            "replies": []
                        }
                    ]
                }
            ]
        },
        {
            "author": "1WeekNotice",
            "body": "Note that this question gets asked a lot so you may want to search this reddit for other post. \n\n-------------------------------------------\n\nIf you want a good learning opportunity you can do this yourself with bash\n\nIt is recommended to stop all docker containers to ensure no data is getting upgraded \n\n- find all docker compose file (helps if they are in one directory) and put them in an array\n- loop through the array and docker / docker compose stop\n- zip the docker volume folder (can also include docker compose files if your structure is like mine)\n  - have the name include the timestamp of when you are doing it\n  - when you zip ensure you keep the folder and files permissions, timestamps of files, etc (there a flags for this)\n- start the docker containers\n- rsync to another location \n  - can also use rclone if you want encryption or if you remote location is on cloud\n- bonus. Deleting older backups. \n  - look for a Linux command (many out their) to find the oldest file in the backup folder\n  - you can count how many backup files you have and if they exceed whatever number you want. Delete the oldest one. \n  - with rsync you can mirror two directory so it will also delete the file once you sync\n  - incase you want to keep files on NAS and a backup drive/ on the VM itself \n\nMy docker structure\n\n````\nsome parent folder\n  docker\n     compose\n        app1\n      volume\n        app1\n\n````\n\nHope that helps",
            "score": 2,
            "replies": []
        },
        {
            "author": "LordAnchemis",
            "body": "Options:  \n\\- back up the VM  \n\\- SMB/NFS the volume, and back up external to the VM  \n\\- SMB/NFS in the volume (from external), and handle the backup externally",
            "score": 1,
            "replies": []
        },
        {
            "author": "Minituff",
            "body": "I do this personally. I run all my containers in a VM and them backup all their data to folder on my TrueNAS Box. \n\n  \nMy workflow is:\n\n1. Mount a TrueNAS NFS Share onto the container VM (step [here](https://minituff.github.io/nautical-backup/advanced/nfs-share/) )\n\n2. Run [nautical-backup](https://github.com/Minituff/nautical-backup) to handle stopping contianers and copying data to the NFS Share\n\n3. Run TrueNAS Snapshots on that dataset\n\n4. Use [Kopia](https://kopia.io/) to save and encrypt backups to Backblaze B2 (This costs about $0.50 a month)",
            "score": 1,
            "replies": []
        },
        {
            "author": "Electrical-Title-193",
            "body": "RemindMe!",
            "score": 0,
            "replies": [
                {
                    "author": "RemindMeBot",
                    "body": "**Defaulted to one day.**\n\nI will be messaging you on [**2025-03-19 20:25:00 UTC**](http://www.wolframalpha.com/input/?i=2025-03-19%2020:25:00%20UTC%20To%20Local%20Time) to remind you of [**this link**](https://www.reddit.com/r/selfhosted/comments/1jeerzk/container_volume_backup_how_to_backup_docker/mii0asm/?context=3)\n\n[**CLICK THIS LINK**](https://www.reddit.com/message/compose/?to=RemindMeBot&subject=Reminder&message=%5Bhttps%3A%2F%2Fwww.reddit.com%2Fr%2Fselfhosted%2Fcomments%2F1jeerzk%2Fcontainer_volume_backup_how_to_backup_docker%2Fmii0asm%2F%5D%0A%0ARemindMe%21%202025-03-19%2020%3A25%3A00%20UTC) to send a PM to also be reminded and to reduce spam.\n\n^(Parent commenter can ) [^(delete this message to hide from others.)](https://www.reddit.com/message/compose/?to=RemindMeBot&subject=Delete%20Comment&message=Delete%21%201jeerzk)\n\n*****\n\n|[^(Info)](https://www.reddit.com/r/RemindMeBot/comments/e1bko7/remindmebot_info_v21/)|[^(Custom)](https://www.reddit.com/message/compose/?to=RemindMeBot&subject=Reminder&message=%5BLink%20or%20message%20inside%20square%20brackets%5D%0A%0ARemindMe%21%20Time%20period%20here)|[^(Your Reminders)](https://www.reddit.com/message/compose/?to=RemindMeBot&subject=List%20Of%20Reminders&message=MyReminders%21)|[^(Feedback)](https://www.reddit.com/message/compose/?to=Watchful1&subject=RemindMeBot%20Feedback)|\n|-|-|-|-|",
                    "score": 0,
                    "replies": []
                }
            ]
        }
    ]
}