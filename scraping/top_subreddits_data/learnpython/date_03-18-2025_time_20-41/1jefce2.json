{
    "title": "How to place one number in the center of each irregular mosaic tile in GIMP Python?",
    "author": "Infinite_Place_6705",
    "subreddit": "learnpython",
    "rank": 18,
    "score": 1,
    "upvote_ratio": 0.67,
    "num_comments (reported by reddit)": 3,
    "url": "https://www.reddit.com/r/learnpython/comments/1jefce2/how_to_place_one_number_in_the_center_of_each/",
    "id": "1jefce2",
    "selftext": "Hey everyone,\n\nI\u2019m working on a GIMP Python script to turn an image into a coloring book-style mosaic. Here\u2019s the process I followed so far:\n\n1. Pixelized the image to reduce detail.\n2. Posterized it to limit the number of colors.\n3. Applied the \"Mosaic\" filter, which creates irregular hexagonal tiles that distort the image.\n4. Wrote a Python script to label each mosaic tile with a number corresponding to its color.\n\nThe problem is that my script doesn\u2019t correctly detect the actual mosaic tiles. Instead of placing one number per irregular tile, it seems to places numbers in a grid pattern, disregarding the actual shape of the tiles. Sometimes places multiple numbers inside a single tile. Sometimes places numbers on tile edges or in between tiles.\n\nWhat I'd love to achieve is:\n\n\\- Each mosaic tile should have exactly one number, placed in its center.\n\n\\- All tiles of the same color should have the same number across the image.\n\n\\- No numbers on borders or overlapping between tiles.\n\nI would really appreciate your help. Thanks in advance:)\n\n    from gimpfu import *\n    import math\n    \n    def number_mosaic_tiles(image, drawable, levels=15):\n        pdb.gimp_image_undo_group_start(image)\n    \n        # Step 1: Get image size\n        width, height = drawable.width, drawable.height\n    \n        # Step 2: Create a new transparent layer for numbers\n        text_layer = pdb.gimp_layer_new(image, width, height, RGBA_IMAGE, \"Numbers\", 100, NORMAL_MODE)\n        image.add_layer(text_layer, 0)\n    \n        # Step 3: Get the pixel data\n        pixel_region = drawable.get_pixel_rgn(0, 0, width, height, False, False)\n    \n        # Step 4: Define a dictionary to store unique colors and their assigned numbers\n        color_map = {}\n        next_number = 1  # Start numbering from 1\n    \n        tile_size = 30  # Adjust based on your mosaic tile size\n        font_size = tile_size // 2  # Make text size proportional to tile size\n    \n        # Step 5: Scan the image for mosaic tiles\n        for y in range(0, height, tile_size):\n            for x in range(0, width, tile_size):\n                # Get the tile's center color\n                center_x = min(x + tile_size // 2, width - 1)\n                center_y = min(y + tile_size // 2, height - 1)\n                pixel_data = pixel_region[center_x, center_y]  # Get raw pixel data\n    \n                # Convert pixel data to RGB tuple\n                color = tuple(ord(pixel_data[i]) for i in range(3))\n    \n                # Assign a number to each unique color\n                if color not in color_map:\n                    if next_number <= levels:\n                        color_map[color] = next_number\n                        next_number += 1\n                    else:\n                        color_map[color] = \"?\"  # More colors than expected\n    \n                # Get the assigned number\n                number = str(color_map[color])\n    \n                # Step 6: Place the number at the center of each tile\n                pdb.gimp_text_fontname(\n                    image, text_layer, x + tile_size // 3, y + tile_size // 3, \n                    number, -1, True, font_size, PIXELS, \"Sans\"\n                )\n    \n        pdb.gimp_image_undo_group_end(image)\n        gimp.displays_flush()\n    \n    register(\n        \"python_fu_number_mosaic_tiles\",\n        \"Number each mosaic tile based on color\",\n        \"Automatically labels each unique mosaic tile with a number\",\n        \"Your Name\", \"Open Source\", \"2025\",\n        \"<Image>/Filters/Custom/Number Mosaic Tiles\",\n        \"*\",\n        [\n            (PF_INT, \"levels\", \"Max number of unique colors\", 15)\n        ],\n        [],\n        number_mosaic_tiles\n    )\n    \n    main()",
    "comments": [
        {
            "author": "djshadesuk",
            "body": "As Mystikal once said: \"[Show me what you're working with](https://youtu.be/Vb2mnDp68S0?t=16)\".",
            "score": 2,
            "replies": [
                {
                    "author": "Infinite_Place_6705",
                    "body": "I edited the post:)",
                    "score": 1,
                    "replies": []
                },
                {
                    "author": "Infinite_Place_6705",
                    "body": "Also this it what the outcome looks like:  \n[https://postimg.cc/bsSw4WsC](https://postimg.cc/bsSw4WsC)",
                    "score": 1,
                    "replies": []
                }
            ]
        }
    ]
}