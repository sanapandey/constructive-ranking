{
    "title": "What's the best way to copy files between machines while preserving hardlink structure",
    "author": "Shajirr",
    "subreddit": "Windows10",
    "rank": 10,
    "score": 4,
    "upvote_ratio": 0.75,
    "num_comments (reported by reddit)": 8,
    "url": "https://www.reddit.com/r/Windows10/comments/1je10z9/whats_the_best_way_to_copy_files_between_machines/",
    "id": "1je10z9",
    "selftext": "I need to transfer files from one PC to another, \nwhile re-creating the same hardlink and symlink structure on the destination drive as it was on the source.\n\nThe programs which could supposedly do that were:\n\n* rsync (cwRsync) \n* Link Shell Extension\n* WinRar.\n\nRobocopy does not work, its incapable of re-creating hardlinks.\n\nWinRar and Link Shell Extension are out in my case due to the large amount of files needing to be transferred (up to 1TB, a million files)\n\nThat leaves rsync\n\nHowever, the destination PC from which the transfer is initiated doesn't see the hardlinks on the source PC. Apparently its a limitation of the network shares in Windows, with the source being on one. This means that rsync doesn't see them too, and thus it can't re-create the hardlinks in the destination.\n________________\n\nAnother issue discovered - even in local transfer tests, hardlinks is the only thing that rsync re-creates.     \nFile symlinks, folder symlinks, junctions - all this fails. This is both with cwRsync and rsync on MSYS2",
    "comments": [
        {
            "author": "LousyMeatStew",
            "body": "Hard links point to MFT records. That's why hard links can't be dereferenced over network shares - the PC doing the dereferencing (the destination PC, in your case) doesn't have access to the MFT of the source PC.\n\nYou'll need to set up cwRsync Server on the source PC to do what you're looking to do.",
            "score": 1,
            "replies": [
                {
                    "author": "Shajirr",
                    "body": "That's a paid solution so its out.\n\nGuess I'll try installing it via something like MSYS2",
                    "score": 1,
                    "replies": [
                        {
                            "author": "LousyMeatStew",
                            "body": "One other option is to do some sort of volume level replication. An example would be running disk2vhd on the source machine, saving the image on the destination and accessing the files by mounting the VHD. At that point, you can replicate the folder structure including hard links to the final location of your choice.\n\nThis is only practical as a one-time copy but you can use this method to \u201cseed\u201d the replication target as well.",
                            "score": 1,
                            "replies": []
                        }
                    ]
                }
            ]
        },
        {
            "author": "MrBallBustaa",
            "body": "I would like to know this aswell, as I have a few modded games over 500+ GB that I someday would have to move.",
            "score": 1,
            "replies": [
                {
                    "author": "LousyMeatStew",
                    "body": "Moving is easy so long as you have physical access to the source and destination, which is usually the case for home use scenarios. Any imaging software like the free version of Macrium Reflect can do this by copying the full volume over. \n\nOngoing replication is the harder part.",
                    "score": 1,
                    "replies": []
                }
            ]
        },
        {
            "author": "Awkward-Candle-4977",
            "body": "Tar pipes to xz then pipes to ssh, telnet, nc tunnel, etc.\n\n\nXz is multithreaded compression so it will be much faster than single threaded gzip etc.\n\n\n\nExample:\n\n\ntar -cf - /var/tmp/source/* | xz -zc -T0 | ssh -c \"aes128-gcm@openssh.com\" apache@10.93.89.75 \"tar -C /var/tmp/nctest/ -vxJf -\"\n\n\nChange the tar option to keep hard and symbolic link",
            "score": 1,
            "replies": [
                {
                    "author": "Shajirr",
                    "body": "that probably works on Linux filesystem only. While files are on NTFS.\n\ntar is supposed to be preserving hardlinks and symlinks by default without anything needed to be specified\n\nJust tried running this command via MSYS2 but without the SSH part, so just between local folders - didn't re-create hardlinks, just separate file duplicates instead, and symlink creation errored out with \"Cannot create symlink to \u2018text.txt\u2019: No such file or directory\"",
                    "score": 1,
                    "replies": [
                        {
                            "author": "LousyMeatStew",
                            "body": "The error sounds like you\u2019re restoring the symlink before the link target. The solution would just be to ignore all errors and run the copy twice. But keep in mind that in MSYS2, [symlinks are not Windows compatible](https://www.msys2.org/docs/symlinks/).",
                            "score": 1,
                            "replies": []
                        }
                    ]
                }
            ]
        }
    ]
}